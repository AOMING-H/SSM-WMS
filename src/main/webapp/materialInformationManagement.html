<!DOCTYPE html>
<html>

	<head>
		<!--<meta charset="utf-8">
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/bootstrap-table.min.css">

		<script type="text/javascript" src="libs/jquery/2.1.1/jquery.min.js"></script>
		<script type="text/javascript" src="libs/popper/popper.min.js"></script>
		<script type="text/javascript" src="libs/bootstrap/4.0.0/bootstrap.min.js"></script>
		<script type="text/javascript" src="libs/bootstrap/4.0.0/bootstrap-table.min.js"></script>
		<script type="text/javascript" src="libs/bootstrap/4.0.0/bootstrap-table-zh-CN.min.js"></script>
		<script type="text/javascript" src="libs/model/common.js"></script>-->
	</head>

	<body>
		<div id="container" class="container">
			<div id="toolbar" class="btn-group" role="group" aria-label="操作">
				<button id="add" type="button" class="fa fa-plus btn btn-primary" onclick="showAddModal()"> 新增</button>
				<button id="edit" type="button" class="fa fa-edit btn btn-secondary"data-toggle="modal" data-target="#modal_edit"> 编辑</button>
				<button id="remove" type="button" class="fa fa-trash btn btn-danger"> 删除</button>
				<button id="advanced_search" type="button" class="fa fa-search-plus btn btn-primary"data-toggle="modal" data-target="#modal_advanced_search"> 高级搜索</button>
			</div>
			<table 
				id="table"
				data-undefined-text="-" 
				data-striped="true" 
				data-method="get" 
				data-content-type="application/x-www-form-urlencoded" 
				data-data-type="json" 
				data-query-params="queryParams" 
				data-query-params-type="un-limit" 
				data-response-handler="responseHandler"
				data-pagination="true" 
				data-side-pagination="server" 
				data-page-number="1" 
				data-page-size="10" 
				data-page-list="[10, 25, 50, 100, ALL]" 
				data-search="true" 
				searchOnEnterKey="false" 
				searchText="" 
				data-show-columns="true" 
				data-show-refresh="true" 
				data-minimum-count-columns="2" 
				data-id-field="id" 
				data-click-to-select="true" 
				data-toolbar="#toolbar" >
			</table>
			
			<div class="modal fade" id="modal_edit">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title">新增物料信息</h4>
							<button type="button" class="close" data-dismiss="modal">&times;</button>
						</div>
						<form id="form_edit" class="needs-validation" novalidate>
							<div class="modal-body">
								<div class="mb-3">
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="input-group-text">料号</span>
										</div>
										<input type="text" class="form-control" name="materialNo" placeholder="材料料号(20个字符内)" required>
										<div class="invalid-feedback" style="width: 100%;">
											请填入材料的料号
										</div>
									</div>
								</div>
								<div class="mb-3">
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="input-group-text">名称</span>
										</div>
										<input type="text" class="form-control" name="name" placeholder="材料名称(40个字符内)" required>
										<div class="invalid-feedback" style="width: 100%;">
											请填入材料的名称
										</div>
									</div>
								</div>
								<div class="mb-3">
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="input-group-text">类别</span>
										</div>
										<select class="custom-select" name="category" required>
											<option value="">请选择</option>
											<option value="RM">RM</option>
											<option value="PP">PP</option>
											<option value="WIP">WIP</option>
											<option value="FP">FP</option>
										</select>
										<div class="invalid-feedback">
											请选择物料类别
										</div>
									</div>
								</div>
								<div class="mb-3">
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="input-group-text">计量单位</span>
										</div>
										<select class="custom-select" name="unit" required>
											<option value="">请选择</option>
											<option value="PCE">PCE</option>
											<option value="Kg">Kg</option>
										</select>
										<div class="invalid-feedback">
											请选择计量单位
										</div>
									</div>
								</div>
								<div class="mb-3">
									<label>描述 <span class="text-muted">(可选)</span></label>
									<textarea class="form-control" name="description" rows="3" placeholder="请输入材料描述"></textarea>
								</div>
							</div>
							<div class="modal-footer">
								<button type="submit" class="btn btn-primary">提交</button>
								<button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			
			<div class="modal fade" id="modal_advanced_search">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title">高级搜索</h4>
							<button type="button" class="close" data-dismiss="modal">&times;</button>
						</div>
						<div class="modal-body">
							高级搜索
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary">搜索</button>
							<button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<script>
			var $table = $('#table'),
				$remove = $('#remove'),
				selections = [];

			function initTable() {
				$table.bootstrapTable({
					url: url_base_materials,  //请求后台的URL（*）
					//url: "data/data1.json",  //请求后台的URL（*）
					columns: [{
							field: 'state',
							checkbox: true,
							align: 'center',
							valign: 'middle'
						},
						{
							field: 'id',
							title: 'ID',
							sortable: true,
							align: 'center'
						},
						{
							field: 'materialNo',
							title: '料号',
							sortable: true,
							align: 'center'
						}, {
							field: 'name',
							title: '名称',
							sortable: true,
							align: 'center'
						}, {
							field: 'category',
							title: '类别',
							sortable: true,
							align: 'center'
						}, {
							field: 'unit',
							title: '计量单位',
							sortable: true,
							align: 'center'
						}, {
							field: 'storageLife',
							title: '保存期(小时)',
							sortable: true,
							align: 'center'
						}, {
							field: 'specifications',
							title: '规格',
							sortable: true,
							align: 'center'
						}, {
							field: 'description',
							title: '描述',
							sortable: true,
							align: 'center'
						}, {
							field: 'updateTime',
							title: '更新时间',
							sortable: true,
							align: 'center',
							formatter: function (value, row, index) {
					            if (value == null) {
					                return "";
					            }
					            var time = new Date(value).toLocaleDateString();
					            return time;
					        }
						}
					]
				});
			}

			function queryParams(params) {
				console.log(params);
				var temp = {
					materialNo: params.searchText,
					pageSize: params.pageSize,   	//页面大小  
				    pageNumber: params.pageNumber,  //页码  
				    sort: params.sort,  			//排序列名  
				    sortOrder: params.sortOrder		//排位命令（desc，asc）  
				};
				return temp;
			}
			
			function responseHandler(res) {
				var table = {
                   	"total": res.data.total,	//总页数
                    "rows": res.data.dataList   //数据
                };
				$.each(table.rows, function(i, row) {
					row.state = $.inArray(row.id, selections) !== -1;
				});
				return table;
			}
			
			function showAddModal() {
				$('#modal_edit').modal('toggle');
				$('#form_edit').off('submit').on('submit', function () {
					var dom_frm = document.getElementById('form_edit');
					var frm = $('#form_edit');
					if (dom_frm.checkValidity() === false) {
		            	console.log("checkValidity false");
			        } else {
				        var dataPara = getFormJson(frm);
				        console.log(dataPara);
						$.ajax({
							url: url_base_materials,
							type: 'POST',
							contentType: "application/json; charset=utf-8",
							data: dataPara,
							success: function(response) {
								var meta = JSON.parse(response).meta;
								var data = JSON.parse(response).data;
							},
							error: function(response) {
								alert(response);
							}
						});
			        }
		            dom_frm.classList.add('was-validated');
					return false;  
                });
			}
			
			$(function() {
				initTable();
			});
		</script>

	</body>

</html>